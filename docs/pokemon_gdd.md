# Pokemon GDD（迭代：主控换模 + 物质枪 + 仇恨/数值）

更新时间：2026-01-17

## 0. 口径与入口

- 工程唯一口径：`docs/master_plan.md`
- 本文定位：本次迭代的设计拆解与验收口径（面向实现）

关键入口（以仓库现状为准）：
- World：`src/js/world/world.js`
- Player：`src/js/world/player/player.js`
- NPC（敌人/动物）：`src/js/world/enemies/humanoid-enemy.js`
- 资源清单：`src/js/sources.js`

## 1. 本迭代目标

在不改变既有“Hub ↔ Dungeon”闭环的前提下，新增一套最小可用的“道具装备 → 锁定 → 激光持续伤害 → 仇恨追击/攻击”的战斗雏形，并把 NPC 数值集中管理，方便后续扩展为“灵兽/宝可梦化”的完整战斗系统。

## 2. 需求拆解

### 2.1 主控换模与动作对齐

目标：
- 将主控模型替换为 `Character_Male_1.gltf`
- 从其 animations 列表中，匹配并覆盖现有主控所有动作（locomotion / jump / falling / standup / punch / block）

边界：
- 若新模型缺少某些动作，允许做最小可用的降级映射（例如缺少左右方向走路时，复用 Walk 作为四向）

验收口径：
- Hub 与 Dungeon 中，主控可正常移动/跑/蹲、可跳跃、Z/X 拳击与 C 格挡不报错、不会因模型结构差异崩溃

### 2.2 物质枪道具：Rock1.gltf

目标：
- `Rock1.gltf` 作为“物质枪”道具进入背包体系
- 玩家打开背包点击该道具后，主控手持该武器
- 举枪姿势：使用主控模型动画 `wave` 的最后一帧作为持枪 Pose

交互协议：
- UI：背包条目提供“装备/卸下”
- World：响应装备事件，将武器挂到主控右手（或可用手部骨骼）

验收口径：
- 装备后可见武器模型且尺寸接近“枪”
- 卸下后武器消失
- 装备状态下主控保持举枪姿态（以 wave 最后一帧为准）

### 2.3 锁定 + 激光弹道 + 持续伤害

目标：
- 当主控手持物质枪且锁定目标（动物/敌人）时，枪口到目标之间持续显示激光弹道
- 命中目标后持续扣血（攻击力设为最低）

规则：
- 仅在“已装备物质枪 + 已锁定目标”时生效
- 伤害方式为 DoT（每帧或定频扣血）
- 命中反馈至少包含：激光可见、目标血条下降

验收口径：
- 可稳定锁定一个目标并看到激光线
- 目标血量随时间下降，最终可触发死亡逻辑（若目标支持死亡）

### 2.4 仇恨与 NPC 攻击 + 数值管理表

目标：
- 任何被物质枪攻击的目标会进入仇恨状态：跑向主控并尝试攻击
- 所有 NPC 具备攻击主控的能力（近身攻击）
- 数值集中管理：HP/攻击力/攻击范围/追击距离/移动速度
- 强度梯度：鸡最低攻击和 HP 最弱，狼最高

数值承接：
- 新增“数值管理表”，由 World 在生成 NPC 时注入（hp）并在 AI 更新时引用（伤害、追击/攻击距离）

验收口径：
- 鸡/狼在相同逻辑下表现出明显强弱差异（HP 与伤害）
- 被激光打到的目标会更积极追击并攻击主控

## 3. 数据设计

### 3.1 道具定义（最小）

| 字段 | 说明 | 示例 |
|---|---|---|
| itemId | 背包内 ID（尽量与资源 key 对齐） | `material_gun` |
| resourceKey | three resources key | `material_gun` |
| type | 道具类型 | `weapon` |
| equipSlot | 装备槽 | `right_hand` |

### 3.2 NPC 数值表（最小字段）

最小字段集合：
- `maxHp`
- `attackDamage`
- `aggroRange`
- `attackRange`
- `moveSpeed`

初始强度梯度（仅用于本迭代验收）：
- 鸡：最低 `maxHp` 与 `attackDamage`
- 狼：最高 `maxHp` 与 `attackDamage`

## 4. 事件与状态

### 4.1 事件（UI → World）

- `inventory:equip`：{ itemId }

### 4.2 World 状态（最小）

- `equippedItemId`：当前装备道具（仅实现物质枪）
- `lockedTarget`：当前锁定目标（动物/敌人）
- `laser`：激光线可视对象与命中状态

## 5. 迭代顺序（Implementation Order）

1) 主控换模与动作对齐（确保不崩溃 + 基础移动/战斗输入可用）
2) 背包内新增物质枪道具 + 装备/卸下 + 持枪 Pose
3) 锁定目标扩展到 Hub 动物与 Dungeon 敌人
4) 激光弹道可视化 + DoT 持续扣血
5) NPC 仇恨与攻击逻辑统一，并接入数值表

## 6. 回归口径

- 流程回归：加载 → Hub → 进地牢 → 出地牢
- 交互回归：B/H 打开背包/仓库；装备/卸下物质枪；中键锁定/解除；激光伤害与仇恨追击
