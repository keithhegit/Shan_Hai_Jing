# PRD —— 魂类锁定敌人预热体验（v2.0）

## 1. 产品概述与目标

### 1.1 产品定位
利用 Three.js 搭建的网页演示，展示 **MC 风格多世界传送门系统** 与 **魂类实时动作战斗**，作为正式游戏发售前的预热入口，验证 Three.js 在游戏宣发场景的可行性。

### 1.2 核心体验流程
```
加载页 → 超平坦世界（传送门选择） → 加载过渡 → 地牢探索（互动/战斗） → 通关 CTA → 返回超平坦
```

### 1.3 成功指标
| 指标 | 目标值 |
|------|--------|
| 平均停留时长 | ≥ 2 分钟 |
| 地牢完成率 | ≥ 70% |
| CTA 点击率 | ≥ 25% |
| 传送门探索率 | 用户平均进入 ≥ 2 个地牢 |

---

## 2. 目标受众
- 原游戏粉丝，熟悉魂类玩法与 MC 美术风格
- 主要使用 **PC 端 Chrome 浏览器**
- 最低支持分辨率：**1380 × 840**
- 期待提前感受正式作品的画面、手感与世界观

---

## 3. 核心功能模块

### 3.1 超平坦世界（初始场景）

#### 3.1.1 场景构成
| 元素 | 规格 | 说明 |
|------|------|------|
| 草坪范围 | 100 × 100 单位 | Perlin 噪音填充，不同亮度对应不同风格草皮方块 |
| 传送门数量 | 3 个 | 经典紫色黑曜石框架 + Shadertoy shader 入口效果 |
| 传送门位置 | 原点附近 | 传送门阵集中布置 |
| 环境效果 | Fog2 雾效 | 营造超平坦世界氛围 |

#### 3.1.2 玩家行为
- **自由移动**：WASD 控制角色在草坪上移动
- **边界限制**：不可离开传送门阵太远（软边界提示或硬边界阻挡）
- **传送触发**：接触传送门 → 触发加载界面 → 进入目标世界

#### 3.1.3 验收标准
- [ ] Perlin 噪音生成多样化草皮纹理
- [ ] 传送门 shader 效果正常渲染
- [ ] 玩家移动流畅，边界约束生效
- [ ] 传送门碰撞检测准确

---

### 3.2 地牢世界探索

#### 3.2.1 地牢结构
| 属性 | 规格 |
|------|------|
| 类型 | 长廊形线性建筑 |
| 长度 | 50 米 |
| 数量 | 3 个（主题待定） |
| 终点 | 返回超平坦世界的传送点 |

#### 3.2.2 可互动物体系统
| 属性 | 规格 |
|------|------|
| 每地牢数量 | 2~3 个互动点 |
| 物体类型 | 宝箱、3D 生成物件 |
| 视觉效果 | **固定颜色全物体轮廓描边 + 自发光** |
| 触发方式 | 走近范围 + 按键（E/F） |
| 交互提示 | CSS2DRenderer 显示按键提示 |

#### 3.2.3 故事展示弹窗
| 属性 | 规格 |
|------|------|
| 触发效果 | 镜头拉近物体 + 右侧信息框弹出 |
| 弹窗内容 | 图片 + 标题 + 描述文字 |
| 游戏状态 | **暂停** |
| 关闭方式 | ESC 键 / 关闭按钮 |

#### 3.2.4 验收标准
- [ ] 地牢模型正确加载，无穿模/卡死
- [ ] 可互动物体描边效果清晰可见
- [ ] 互动提示正确显示/隐藏
- [ ] 弹窗动画流畅，游戏正确暂停/恢复
- [ ] 地牢终点可正确返回超平坦世界

---

### 3.3 魂类实时动作战斗系统

#### 3.3.1 怪物行为
| 属性 | 规格 |
|------|------|
| 初始状态 | 固定位置等待玩家靠近 |
| 攻击模式 | Zombie Attack（简单攻击动作） |
| 攻击预警 | 攻击前光幕圈效果增强 |
| 移动行为 | 原地等待，不追击玩家 |
| 战斗规模 | 1v1 单挑 |

#### 3.3.2 锁定机制
| 操作 | 说明 |
|------|------|
| 锁定触发 | 准星对准怪物 + **鼠标中键** |
| 锁定 VFX | 准星圆圈收缩动画 |
| 怪物 VFX | 红色描边 + 脚底光幕圈（半径 = 身高 30%，持续 pulsate） |
| 血条显示 | 头顶 3D Billboard（血条 + 名称） |
| 镜头行为 | 可微调，但 target 始终锁定怪物 |
| 脱离战斗 | 自由跑开即可脱离，无强制封锁 |

#### 3.3.3 玩家战斗操作
| 操作 | 按键 | 说明 |
|------|------|------|
| 普通攻击 | 鼠标左键 | 支持连击 Combo |
| 重攻击 | 鼠标右键 | 蓄力/耗时长 |
| 格挡 | C 键 | 防御敌人攻击 |

#### 3.3.4 伤害与反馈
| 效果 | 说明 |
|------|------|
| 命中反馈 | 伤害飘字（Damage Number） |
| 受击反馈 | 屏幕红闪 + 震动 |
| 怪物死亡 | 播放死亡动画 → 消失 |
| 玩家死亡 | 重生在地牢入口 |

#### 3.3.5 验收标准
- [ ] 锁定机制响应准确，VFX 效果正常
- [ ] 攻击 Combo 流畅衔接
- [ ] 格挡判定正确
- [ ] 伤害飘字、受击反馈同步
- [ ] 怪物攻击预警清晰可见
- [ ] 死亡/重生流程无异常

---

### 3.4 HUD / UI 系统

#### 3.4.1 玩家状态（屏幕底部中央）
| 元素 | 规格 |
|------|------|
| 血量显示 | **3D 心形模型**（heart.glb） |
| 体力显示 | 体力条（用于攻击/格挡消耗） |

#### 3.4.2 操作提示
| 位置 | 内容 |
|------|------|
| 右下角 | 按键常驻提示（WASD / 攻击 / 格挡 / 锁定） |
| 互动物体旁 | CSS2DRenderer 动态提示 |

#### 3.4.3 导航系统
| 位置 | 内容 |
|------|------|
| 左上角 | 简单指南针（地牢线性，仅作方向参考） |

#### 3.4.4 战斗视觉效果
| 效果 | 说明 |
|------|------|
| Vignette | 战斗时屏幕四角暗部效果 |

#### 3.4.5 加载界面
| 元素 | 说明 |
|------|------|
| 内容 | 显示目标世界名称 |
| 触发 | 进入传送门时 |

#### 3.4.6 验收标准
- [ ] 3D 心形血量模型正确渲染
- [ ] 体力条消耗/恢复动画流畅
- [ ] 按键提示清晰可读
- [ ] 指南针方向正确
- [ ] Vignette 效果正确触发/解除
- [ ] 加载界面正常显示目标世界名称

---

### 3.5 CTA 与商业转化

#### 3.5.1 CTA 弹窗
| 属性 | 规格 |
|------|------|
| 触发时机 | 每个地牢通关后弹出 |
| 弹窗内容 | 游戏宣传图 + "敬请期待" |
| 可关闭 | 是，关闭后可继续探索 |
| 跳转目标 | 暂无（实验性网站） |

#### 3.5.2 验收标准
- [ ] CTA 弹窗正确触发
- [ ] 关闭后可正常返回超平坦世界
- [ ] 弹窗动画流畅

---

## 4. 技术栈与实现建议

### 4.1 核心技术栈
| 类别 | 技术 |
|------|------|
| 渲染框架 | Vite + Three.js（ES Modules） |
| UI 框架 | Vue 3（现有 HUD 复用） |
| 状态管理 | Pinia + mitt 事件总线 |
| 2D 标签 | CSS2DRenderer |
| 物理/碰撞 | 自定义或轻量库 |

### 4.2 资源管理
| 类别 | 规格 |
|------|------|
| 模型格式 | glTF/GLB（Draco 压缩） |
| 资源声明 | `src/js/sources.js` 统一管理 |
| Shader | `src/shaders/` 目录，使用 vite-glsl-plugin |

### 4.3 状态机设计
```
┌─────────────┐     进入传送门     ┌─────────────┐
│  超平坦世界  │ ──────────────→ │   加载过渡   │
└─────────────┘                  └─────────────┘
       ↑                               │
       │                               ↓
       │                         ┌─────────────┐
       │                         │  地牢探索   │
       │                         └─────────────┘
       │                               │
       │         ┌─────────────────────┼─────────────────────┐
       │         ↓                     ↓                     ↓
       │   ┌───────────┐         ┌───────────┐         ┌───────────┐
       │   │ 互动弹窗  │         │ 战斗锁定  │         │ 到达终点  │
       │   │  (暂停)   │         │           │         │           │
       │   └───────────┘         └───────────┘         └───────────┘
       │         │                     │                     │
       │         ↓                     ↓                     ↓
       │     关闭弹窗              击败/逃离             ┌───────────┐
       │         │                     │                 │ CTA 弹窗  │
       │         └─────────────────────┼─────────────────└───────────┘
       │                               │                       │
       └───────────────────────────────┴───────────────────────┘
```

### 4.4 部署与监控
| 类别 | 方案 |
|------|------|
| 托管 | Vercel 静态部署 |
| 压缩 | gzip + HTTP2 |
| 埋点 | Vercel Analytics + 自定义事件（传送门进入、地牢完成、CTA 点击） |

---

## 5. 概念数据模型（内存态）

| 实体 | 字段 | 说明 |
|------|------|------|
| `PlayerState` | `position(vec3)`, `direction(vec3)`, `hp(int)`, `stamina(int)`, `status(enum)`, `isLocked(bool)` | 玩家实时状态 |
| `EnemyState` | `id`, `hp(int)`, `maxHp(int)`, `name(string)`, `isAlive(bool)`, `isLocked(bool)` | 怪物状态 |
| `WorldState` | `currentWorld('flatland'/'dungeon1'/'dungeon2'/'dungeon3')`, `dungeonProgress(float)` | 世界状态 |
| `InteractableObject` | `id`, `type('chest'/'item')`, `title`, `description`, `imageUrl`, `isDiscovered(bool)` | 可互动物体 |
| `UIContext` | `phase(enum)`, `showCTA(bool)`, `showStoryPopup(bool)`, `currentInteractable(id)` | UI 渲染状态 |
| `CombatContext` | `targetEnemy(id)`, `comboCount(int)`, `isBlocking(bool)`, `lastDamage(int)` | 战斗上下文 |

> 数据不做持久化，刷新页面即重置；无需账号体系。

---

## 6. UI 设计原则

### 6.1 视觉风格
- **沉浸感**：暗色石砖背景 + 体积雾，UI 使用像素化描边、半透明背景
- **MC 风格**：3D 心形血量、方块化元素
- **魂类氛围**：战斗时 Vignette 暗角、红色锁定描边

### 6.2 层级规范
```
Z-Index 层级（从低到高）：
1. 3D 场景
2. CSS2DRenderer 标签
3. HUD（血量/体力/按键提示）
4. 战斗 Vignette 叠加
5. 互动弹窗 / CTA 模态框
```

### 6.3 动效规范
| 效果 | 时长 | 缓动 |
|------|------|------|
| 锁定圆圈收缩 | 300ms | ease-out |
| 血量/体力变化 | 200ms | linear |
| 弹窗出现 | 400ms | ease-out |
| Vignette 渐变 | 500ms | ease-in-out |
| 镜头拉近物体 | 600ms | ease-out |

---

## 7. 安全与可靠性

- 资源文件采用 hash 命名，防止缓存污染
- 启用基础 CSP（`default-src 'self'`）
- 输入监听限制在 canvas 或窗口焦点
- 战斗状态机添加异常处理，防止死循环

---

## 8. 开发阶段与里程碑

### P0 必须（MVP）- 预计 2 周
| 任务 | 预计时间 |
|------|----------|
| 超平坦世界基础场景 + Fog | 2 天 |
| 传送门模型 + Shader 效果 | 2 天 |
| 1 个完整地牢（50m 线性） | 2 天 |
| 玩家移动 + 碰撞系统 | 2 天 |
| 战斗锁定系统（VFX + 攻击/防御） | 3 天 |
| 基础 HUD（血量/体力/按键提示） | 2 天 |
| CTA 弹窗 | 1 天 |

### P1 重要 - 预计 1.5 周
| 任务 | 预计时间 |
|------|----------|
| 剩余 2 个地牢场景 | 3 天 |
| 可互动物体系统（描边 + 弹窗） | 2 天 |
| BGM / 音效集成（Suno AI） | 2 天 |
| 怪物攻击预警 VFX | 1 天 |

### P2 优化 - 预计 1 周
| 任务 | 预计时间 |
|------|----------|
| Perlin 噪音草坪生成 | 2 天 |
| 指南针 UI | 0.5 天 |
| 战斗 Vignette 效果 | 0.5 天 |
| 性能优化（资源压缩/懒加载） | 2 天 |
| QA 与 Bug 修复 | 2 天 |

---

## 9. 潜在挑战与应对

| 挑战 | 解决方案 |
|------|----------|
| **传送门 Shader 性能** | 使用 LOD 或降低分辨率，远距离简化渲染 |
| **实时战斗手感** | 调试攻击帧数、受击反馈、Combo 窗口时间 |
| **3D 心形血量渲染** | 确保 Billboard 朝向正确，与 UI 层级协调 |
| **大模型加载** | 采用 Loading 过渡 + 后台预热下一地牢资源 |
| **Perlin 噪音性能** | 预计算噪音贴图，避免实时计算 |
| **描边效果实现** | 使用后处理 Outline Pass 或 Shader 方案 |

---

## 10. 未来扩展

- 增加更多地牢主题（冰霜洞穴、熔岩矿坑等）
- 增加更多怪物类型与攻击模式
- 引入技能系统（Q/E 主动技能）
- 支持移动端触控操作
- 社交分享功能
- 多语言支持
- 排行榜 / 成就系统

---

## 11. 按键操作速查表

| 操作 | 按键 |
|------|------|
| 移动 | W / A / S / D |
| 普通攻击 | 鼠标左键 |
| 重攻击 | 鼠标右键 |
| 锁定目标 | 鼠标中键 |
| 格挡 | C |
| 互动 | E / F |
| 关闭弹窗 | ESC |

---

## 附录 A：资源清单（待补充）

| 资源名称 | 类型 | 来源 | 状态 |
|----------|------|------|------|
| 超平坦草皮贴图集 | Texture | 自制/素材库 | 待制作 |
| 传送门黑曜石框架 | Model | Blender | 待制作 |
| 传送门入口 Shader | Shader | Shadertoy 移植 | 待移植 |
| 地牢 1/2/3 场景 | Model | Blender | 待制作 |
| Steve 角色模型 | Model | 现有 | ✓ |
| Zombie 怪物模型 | Model | 现有/素材库 | 待确认 |
| heart.glb 血量模型 | Model | 自制 | 待制作 |
| 宝箱模型 | Model | 自制/3D 生成 | 待制作 |
| BGM 音频 | Audio | Suno AI | 待生成 |

---

> **版本记录**
> - v2.0 (2024-12) - 重大更新：多世界传送门系统、实时动作战斗、3D 心形血量
> - v1.0 - 初版：单地牢回合制战斗演示

---

请在实现过程中根据 Three.js 框架规范，保持 Experience 单例的依赖获取方式，并为新增组件添加中文调试注释与控制面板（`debugInit`），确保与现有代码风格一致。
